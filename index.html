<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Berita & Pengumuman — Form Input</title>
  <style>
    :root{
      --bg:#f4f6f9; --card:#ffffff; --muted:#6b7280; --accent:#0f766e;
      --danger:#ef4444; --glass: rgba(15,118,110,0.06);
      --shadow: 0 6px 18px rgba(16,24,40,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#eef2f7);min-height:100vh;color:#0f172a}
    .container{max-width:1100px;margin:36px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{width:68px;height:68px;border-radius:12px;background:var(--glass);display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow)}
    .logo svg{width:42px;height:42px}
    h1{font-size:20px;margin:0}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:var(--shadow);}
form .row{display:flex;gap:12px}
.col{flex:1}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input[type=text], input[type=date], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;background:#fff;font-size:14px}
textarea{min-height:120px;resize:vertical}

.controls{display:flex;gap:12px;align-items:center;margin-top:12px}
.btn{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.btn-primary{background:var(--accent);color:#fff}
.btn-ghost{background:transparent;border:1px solid #e6e9ef}
.btn-danger{background:var(--danger);color:#fff}

.icon-btn{width:40px;height:40px;border-radius:10px;display:inline-grid;place-items:center;border:0;background:#fff;cursor:pointer;box-shadow:0 4px 12px rgba(2,6,23,0.06)}

.table-wrap{margin-top:18px}
table{width:100%;border-collapse:collapse;background:transparent}
thead th{background:#fbfcfd;text-align:left;padding:12px;border-bottom:1px solid #eef2f6;color:var(--muted);font-size:13px}
tbody td{padding:14px;border-bottom:1px solid #f1f5f9;vertical-align:top}
.title{font-weight:700}
.meta{font-size:12px;color:var(--muted)}

.actions{display:flex;gap:8px}
.chip{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--glass);font-size:12px}

.small{font-size:13px;color:var(--muted)}

/* responsive */
@media (max-width:800px){
  .row{flex-direction:column}
  .controls{flex-direction:column;align-items:stretch}
  header{flex-direction:column;align-items:flex-start;gap:6px}
}

/* subtle table image */
.thumb{width:64px;height:48px;border-radius:6px;object-fit:cover;border:1px solid #eef3f6}

/* search */
.topbar{display:flex;justify-content:space-between;gap:12px;margin-bottom:10px}
.search{display:flex;gap:8px;align-items:center}
.search input{padding:8px 10px;border-radius:10px;border:1px solid #e6e9ef}

footer{margin-top:12px;color:var(--muted);font-size:13px}

  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <!-- professional plus/news icon -->
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="4" fill="white"/>
          <path d="M7 11h10M12 7v10" stroke="#0f766e" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div>
        <h1>Berita & Pengumuman</h1>
        <p class="lead">Form input untuk menambahkan berita, pengumuman, kalender acara, dan menampilkan daftar berita yang tersimpan.</p>
      </div>
    </header><div class="card">
  <div class="topbar">
    <div style="display:flex;gap:10px;align-items:center">
      <button id="btnAddNew" class="btn btn-primary" title="Tambah Berita">
        <!-- plus icon -->
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Tambah Berita
      </button>
      <button id="exportBtn" class="btn btn-ghost" title="Ekspor JSON">Ekspor</button>
      <label for="importFile" class="btn btn-ghost" style="cursor:pointer">Impor</label>
      <input id="importFile" type="file" accept="application/json" style="display:none">
    </div>

    <div class="search">
      <input id="q" placeholder="Cari judul atau kategori..." />
      <div class="chip" id="count">0 data</div>
    </div>
  </div>

  <form id="form" style="margin-top:12px;display:none" class="card">
    <div class="row">
      <div class="col">
        <label>Judul</label>
        <input id="judul" type="text" placeholder="Judul berita / pengumuman" required>
      </div>
      <div style="width:220px">
        <label>Tanggal</label>
        <input id="tanggal" type="date">
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="col">
        <label>Kategori</label>
        <select id="kategori">
          <option value="Umum">Umum</option>
          <option value="Pengumuman">Pengumuman</option>
          <option value="Kegiatan">Kegiatan</option>
          <option value="Kalender">Kalender</option>
        </select>
      </div>
      <div style="width:220px">
        <label>Gambar (opsional)</label>
        <input id="gambar" type="file" accept="image/*">
      </div>
    </div>

    <div style="margin-top:12px">
      <label>Isi Berita / Pengumuman</label>
      <textarea id="isi" placeholder="Tulis isi berita..." required></textarea>
    </div>

    <div class="controls">
      <button id="saveBtn" class="btn btn-primary" type="submit">Simpan</button>
      <button id="cancelBtn" type="button" class="btn btn-ghost">Batal</button>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Status: <span id="modeLabel">Tambah</span></div>
    </div>
  </form>

  <div class="table-wrap">
    <table id="table">
      <thead>
        <tr><th>Berita</th><th>Kategori</th><th>Tanggal</th><th style="width:140px">Aksi</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>
    Tips: Semua data disimpan permanen di browser (localStorage). Gunakan tombol Ekspor untuk membuat cadangan dan Impor untuk mengembalikan data.
  </footer>
</div>

  </div>  <script>
    // util icons
    const ICON_EDIT = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 21l3-1 11-11a2.828 2.828 0 0 0 0-4l-1-1a2.828 2.828 0 0 0-4 0L1 15v5z" stroke="#0f766e" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    const ICON_DELETE = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6M10 6V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2" stroke="#ef4444" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    const ICON_VIEW = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z" stroke="#0f766e" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="3" stroke="#0f766e" stroke-width="1.2"/></svg>`;

    const LS_KEY = 'berita_pengumuman_v1';

    // elements
    const formWrap = document.getElementById('form');
    const btnAddNew = document.getElementById('btnAddNew');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const modeLabel = document.getElementById('modeLabel');
    const tbody = document.querySelector('#table tbody');
    const q = document.getElementById('q');
    const countChip = document.getElementById('count');

    const judulEl = document.getElementById('judul');
    const tanggalEl = document.getElementById('tanggal');
    const kategoriEl = document.getElementById('kategori');
    const gambarEl = document.getElementById('gambar');
    const isiEl = document.getElementById('isi');

    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');

    let data = [];
    let editId = null;

    // load
    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        data = raw ? JSON.parse(raw) : [];
      }catch(e){data = []}
    }
    function saveAll(){
      localStorage.setItem(LS_KEY, JSON.stringify(data));
    }

    function uid(){return Date.now().toString(36) + Math.random().toString(36).slice(2,8)}

    function render(){
      const filter = q.value.trim().toLowerCase();
      tbody.innerHTML = '';
      const list = data.filter(d => !filter || (d.judul + ' ' + d.kategori + ' ' + d.isi).toLowerCase().includes(filter));
      list.forEach(d => {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td');
        td1.innerHTML = `
          <div style="display:flex;gap:12px;align-items:flex-start">
            <div>
              ${d.gambar ? `<img src="${d.gambar}" class="thumb" alt="thumb">` : `<div style=\"width:64px;height:48px;border-radius:6px;background:#f8fafc;display:grid;place-items:center;border:1px solid #eef3f6;color:var(--muted)\">No image</div>`}
            </div>
            <div>
              <div class="title">${escapeHtml(d.judul)}</div>
              <div class="meta">${escapeHtml(d.isi.slice(0,150))}${d.isi.length>150? '...':''}</div>
            </div>
          </div>`;
        const td2 = document.createElement('td'); td2.innerHTML = `<div class="small">${escapeHtml(d.kategori)}</div>`;
        const td3 = document.createElement('td'); td3.innerHTML = `<div class="small">${d.tanggal || '-'}</div>`;
        const td4 = document.createElement('td'); td4.innerHTML = `
          <div class="actions">
            <button class="icon-btn" title="Lihat" data-id="${d.id}" data-act="view">${ICON_VIEW}</button>
            <button class="icon-btn" title="Edit" data-id="${d.id}" data-act="edit">${ICON_EDIT}</button>
            <button class="icon-btn" title="Hapus" data-id="${d.id}" data-act="del">${ICON_DELETE}</button>
          </div>`;
        tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
        tbody.appendChild(tr);
      });
      countChip.textContent = list.length + ' data';
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c])}

    // show form
    btnAddNew.addEventListener('click', ()=>{
      editId = null; modeLabel.textContent='Tambah'; saveBtn.textContent='Simpan'; formWrap.style.display='block'; formWrap.scrollIntoView({behavior:'smooth'});
      formReset();
    });

    cancelBtn.addEventListener('click', ()=>{formWrap.style.display='none'; formReset();});

    // handle image to base64
    function fileToDataUrl(file){
      return new Promise((res,rej)=>{
        const r = new FileReader();
        r.onload = ()=>res(r.result);
        r.onerror = rej;
        r.readAsDataURL(file);
      });
    }

    document.getElementById('form').addEventListener('submit', async function(e){
      e.preventDefault();
      saveBtn.disabled = true;
      let gambarData = null;
      if (gambarEl.files && gambarEl.files[0]){
        try{gambarData = await fileToDataUrl(gambarEl.files[0]);}catch(e){console.warn(e)}
      }

      const item = {
        id: editId || uid(),
        judul: judulEl.value.trim(),
        tanggal: tanggalEl.value || '',
        kategori: kategoriEl.value,
        isi: isiEl.value.trim(),
        gambar: gambarData || (editId ? (data.find(x=>x.id===editId)||{}).gambar : null),
        created: new Date().toISOString()
      };

      if (!item.judul || !item.isi){alert('Judul dan isi harus diisi'); saveBtn.disabled=false; return}

      if (editId){
        data = data.map(d=> d.id===editId ? item : d);
        editId = null; modeLabel.textContent='Tambah'; saveBtn.textContent='Simpan';
      } else {
        data.unshift(item); // newest first
      }
      saveAll(); render(); formWrap.style.display='none'; formReset(); saveBtn.disabled=false;
    });

    // table actions
    tbody.addEventListener('click', function(e){
      const btn = e.target.closest('button'); if(!btn) return;
      const id = btn.dataset.id; const act = btn.dataset.act;
      const item = data.find(d=>d.id===id);
      if(!item) return;
      if(act==='del'){
        if(!confirm('Hapus data ini secara permanen?')) return;
        data = data.filter(d=>d.id!==id); saveAll(); render();
      } else if (act==='edit'){
        editId = id; modeLabel.textContent='Edit'; saveBtn.textContent='Simpan Perubahan';
        judulEl.value = item.judul; tanggalEl.value = item.tanggal; kategoriEl.value = item.kategori; isiEl.value = item.isi; gambarEl.value = null;
        formWrap.style.display='block'; formWrap.scrollIntoView({behavior:'smooth'});
      } else if (act==='view'){
        // show modal-like quick view
        const w = window.open('', '_blank', 'noopener');
        w.document.write(`<title>${escapeHtml(item.judul)}</title><style>body{font-family:Inter,Arial;padding:18px}</style>`);w.document.write(`<h2>${escapeHtml(item.judul)}</h2><div style="color:#6b7280">${item.tanggal||''} • ${escapeHtml(item.kategori)}</div><hr>`);
    if(item.gambar) w.document.write(`<img src="${item.gambar}" style="max-width:100%;height:auto;border-radius:8px;margin:8px 0">`);
    w.document.write(`<div style="white-space:pre-wrap;margin-top:10px">${escapeHtml(item.isi)}</div>`);
    w.document.close();
  }
});

// search
q.addEventListener('input', debounce(()=>render(), 250));

// export
exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='berita_pengumuman_backup.json'; a.click(); URL.revokeObjectURL(url);
});

importFile.addEventListener('change', function(){
  const f = this.files[0]; if(!f) return; const r = new FileReader();
  r.onload = ()=>{
    try{
      const parsed = JSON.parse(r.result);
      if(Array.isArray(parsed)){
        // merge safely
        const merged = parsed.concat(data);
        // ensure unique ids
        const uniq = [];
        const map = {};
        merged.forEach(it=>{ if(!map[it.id]){ map[it.id]=true; uniq.push(it)} });
        data = uniq; saveAll(); render(); alert('Impor selesai');
      } else alert('Format file tidak sesuai');
    }catch(e){alert('Gagal membaca file: '+e.message)}
  };
  r.readAsText(f);
  this.value='';
});

function formReset(){
  editId = null; judulEl.value=''; tanggalEl.value=''; kategoriEl.value='Umum'; gambarEl.value=''; isiEl.value='';
}

// utils
function debounce(fn, t){ let to; return (...a)=>{ clearTimeout(to); to=setTimeout(()=>fn(...a), t); } }

// init
load(); render();

  </script>
</body>
</html>
